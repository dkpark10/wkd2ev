{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/타입 세이프하게 api를 호출해보자/","result":{"data":{"site":{"siteMetadata":{"title":"wkd2ev"}},"markdownRemark":{"id":"f60ee1fa-8ff9-5794-b402-e21d567fc740","excerpt":"최근 사내에서 서비스 개발 시 type safe하게 api를 호출할 수 있어 좋았던 경험이 있다.\n이를 좀 더 개선하여 간략하게 개발할 수 있도록 작성해 보았다. URL 구조 URL 구조는 다음과 같이 분리할 수 있다. 내용 설명 https 프로토콜 example.com…","html":"<p>최근 사내에서 서비스 개발 시 type safe하게 api를 호출할 수 있어 좋았던 경험이 있다.\n이를 좀 더 개선하여 간략하게 개발할 수 있도록 작성해 보았다.</p>\n<h2>URL 구조</h2>\n<deckgo-highlight-code   >\n          <code slot=\"code\">https://example.com/content/1?start=0&amp;end=10</code>\n        </deckgo-highlight-code>\n<p>URL 구조는 다음과 같이 분리할 수 있다.</p>\n<table>\n<thead>\n<tr>\n<th>내용</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>https</td>\n<td>프로토콜</td>\n</tr>\n<tr>\n<td>example.com</td>\n<td>도메인</td>\n</tr>\n<tr>\n<td>content/1</td>\n<td>경로</td>\n</tr>\n<tr>\n<td>?start=0&#x26;end=10</td>\n<td>쿼리스트링</td>\n</tr>\n</tbody>\n</table>\n<p>아무래도 회사마다 개발자마다 다르겠지만 기본적으로\nbaseUrl은 프로토콜과 도메인 까지는 기본 설정으로 주입하고 사용될 것이다.</p>\n<deckgo-highlight-code language=\"typescript\"  >\n          <code slot=\"code\">import axios from &#39;axios&#39;;\nimport got from &#39;got&#39;;\n\nconst axiosInstance = axios.create({\n  baseURL: &#39;https://example.com&#39;\n});\n\nconst gotClient = got.extend({\n  url: &#39;https://example.com&#39;,\n});</code>\n        </deckgo-highlight-code>\n<p>예를 들어 호출해야 하는 api 주소가 아래와 같다고 해보자.\n해당 api는 유저가 입력한 키워드의 보여줄 게시글들을 반환하는데 키워드가 있고\n정렬 타입이 있으며 pagination 이 적용되어 있다.</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">https://example.com/search/?keyword=맛집&amp;order=desc&amp;start=0&amp;end=10</code>\n        </deckgo-highlight-code>\n<p>이를 호출한다면 다음과 같을 것이다.</p>\n<deckgo-highlight-code language=\"typescript\"  >\n          <code slot=\"code\">await axios.get(\n    `https://example.com/search/?keyword=${keyword}&amp;order=${order}&amp;start=${start}&amp;end=${end}`\n  );</code>\n        </deckgo-highlight-code>\n<p>그렇지만 api엔드포인트의 수정사항이 들어왔을 때 해당 api를 사용하는 쪽에 일괄 수정이 필요할 것이다.\n사실 이렇게 호출하는 방법이 좋지 않은 것을 알고 있을 것이다.</p>\n<p>변경에 취약하기에 한번 함수로 감싸주는 것만으로 원할한 해결이 가능하다. 함수로 감싼다면 수정해야할\n관리 포인트를 하나로 집중할 수 있으니까</p>\n<deckgo-highlight-code language=\"typescript\"  >\n          <code slot=\"code\">async function getKeywordContents(\n  keyword: string, order: &#39;desc&#39; | &#39;asec&#39;, start: number, end: number) {\n\n  return await axios.get(\n    `https://example.com/search/?keyword=${keyword}&amp;order=${order}&amp;start=${start}&amp;end=${end}`\n  );\n}</code>\n        </deckgo-highlight-code>\n<p>사실 api 호출 코드는 처음 프로젝트를 작성할 때 말고는 수정사항이 빈번한 영역이라고 보기는 힘들다.\n다만 처음 작성할 때 수정사항에 대응 하여 좀 더 수월하게 개발 할 수 있다면 더 좋을 것이다.</p>\n<h2>적용</h2>\n<p><em>endpoint.ts</em></p>\n<deckgo-highlight-code language=\"typescript\"  >\n          <code slot=\"code\">type UpperMethod =\n  | &#39;GET&#39;\n  | &#39;POST&#39;\n  | &#39;PUT&#39;\n  | &#39;PATCH&#39;\n  | &#39;DELETE&#39;\n  | &#39;HEAD&#39;\n  | &#39;OPTIONS&#39;;\n\ntype LowerMethod = Lowercase&lt;UpperMethod&gt;;\n\ntype Method = UpperMethod | LowerMethod;\n\ntype EndPoint = &#39;search&#39;;\n\ntype QueryParams = {\n  [Key in EndPoint]: Key extends &#39;search&#39;\n    ? {\n        keyword: string;\n        start: number;\n        end: number;\n      }\n    : {\n        [key: string]: any;\n      };\n};</code>\n        </deckgo-highlight-code>\n<p><em>index.ts</em></p>\n<deckgo-highlight-code language=\"typescript\"  >\n          <code slot=\"code\">import { Client, type Response } from &#39;./client&#39;;\nimport type { Method, QueryParams, EndPoint } from &#39;../endpoint&#39;;\n\nexport default class ApiClient&lt;\n  Url extends EndPoint,\n  Data extends any = any,\n  Body extends Record&lt;string, any&gt; = any,\n&gt; extends Client {\n  private url: URL;\n\n  private body: Body;\n\n  private method: Method = &#39;get&#39;;\n  \n  private headers: Record&lt;string, any&gt; = {};\n\n  constructor() {\n    super();\n  }\n\n  public setUrl(url: Url) {\n    try {\n      this.url = new URL(`${this.baseURL}/${url}`);\n      return this;\n    } catch (error) {\n      console.error(&#39;URL error&#39;, error);\n    }\n  }\n\n  public setMethod&lt;M extends Method = &#39;get&#39;&gt;(method: M) {\n    this.method = method;\n    return this;\n  }\n\n  public setQuery&lt;K extends keyof QueryParams[Url]&gt;(\n    key: K,\n    value: QueryParams[Url][typeof key]\n  ) {\n    if (!this.url) throw new Error(&#39;url이 설정되어 있지 않습니다.&#39;);\n\n    this.url.searchParams.set(String(key), String(value));\n    return this;\n  }\n\n  public setBody(body: Body) {\n    this.body = body;\n    return this;\n  }\n\n  public async retrieve(): Promise&lt;Response&lt;Data&gt;&gt; {\n    const reqData = this.transform&lt;Body&gt;({\n      url: this.url,\n      method: this.method,\n      body: this.body,\n      headers: this.headers,\n    });\n    return await this.instance&lt;Data&gt;(reqData).then((res) =&gt; this.response(res));\n  }\n}</code>\n        </deckgo-highlight-code>\n<p><em>client.ts</em></p>\n<deckgo-highlight-code language=\"typescript\"  >\n          <code slot=\"code\">import axios, {\n  AxiosResponse,\n  type AxiosInstance,\n  AxiosRequestConfig,\n} from &#39;axios&#39;;\nimport type { Method } from &#39;../types&#39;;\n\nconst baseURL = &#39;https://example.com&#39;;\n\nconst axiosInstance: AxiosInstance = axios.create({\n  baseURL,\n});\n\nexport interface Request&lt;Body&gt; {\n  url: URL;\n  method: Method;\n  body?: Body;\n  headers?: Record&lt;string, any&gt;;\n}\n\nexport interface Response&lt;D&gt; {\n  status: number;\n  data: D;\n}\n\nexport abstract class Client {\n  protected baseURL = baseURL;\n\n  protected instance: AxiosInstance;\n\n  constructor() {\n    this.instance = axiosInstance;\n  }\n\n  protected response&lt;Data&gt;(response: AxiosResponse&lt;Data&gt;): Response&lt;Data&gt; {\n    const { status, data } = response;\n    return { status, data };\n  }\n\n  protected transform&lt;Body&gt;({ url, method, body }: Request&lt;Body&gt;): AxiosRequestConfig {\n    return {\n      url: url.href,\n      method,\n      data: body,\n    };\n  }\n}</code>\n        </deckgo-highlight-code>\n<p>굳이 이렇게 까지 작성해야 하나 싶지만 처음 신경써서 작성한다면 클러이언트 호출 시 type safe하게 호출하여\nDX가 좋았다. 사용하는 쪽에서 자동완성으로 편하게 호출할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1a436d700c252066023b716654965123/65654/type-safe.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7UlEQVR42kWP207CQBRF+RDFmtAyvcwwLUyZttAqptYokSjUy4P//xnLIwnxYWWfnMvOPhNtNtjsgYW9w5WipsX6AVsN+OGL5/GH0/jB4fhNfxrJuy22aOjqDUXVEWWeJF2j0vLMRC8axuOeYf9I+/ZCOz6h6x7tdihZXlqHW1VkRo5yJ31PqktcUWIKz0wtiYR57FCxGEZJweuhkRSS7N5j+5owzslcRSpGc+uZhoabyBCIBjNNIPW5F2pu5+ZMlElC45kkusKtG7byil41hJEMVEm96vjs3xl3B2aJ5UpppkqMYvOvl1q4lvkfvyOagICSk9ewAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"type-safe한 api 호출\"\n        title=\"\"\n        src=\"/static/1a436d700c252066023b716654965123/f058b/type-safe.png\"\n        srcset=\"/static/1a436d700c252066023b716654965123/c26ae/type-safe.png 158w,\n/static/1a436d700c252066023b716654965123/6bdcf/type-safe.png 315w,\n/static/1a436d700c252066023b716654965123/f058b/type-safe.png 630w,\n/static/1a436d700c252066023b716654965123/65654/type-safe.png 872w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>타입을 잘못 지정할 경우 에러를 뱉을 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/edee780ad281cfaa43ccbc7d226f05e7/58213/type-unsafe.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMklEQVR42oWQ2VLCQBBF+RKrRFmEEJaQIGSZrIQEQtg3XxD9/184DkFKyxcfTnVX99S5XVNqt3zUjo0pUhb7M3G2Q4R5UU2REM92TCSW3AfxCi+cEyUbNscPudtiu1OS+YE0PyKCjNJhm2NFEV6cs5yeGHtzpukeX8xw3YzF7ozjZ4X4JtlhezNmyzeMYYQlhb4M0l9D1K5N6fI5YbEN6I9CQifFGyV4vRBb9Rh0fUxXioMcRwZdCScbOj2XemOIoloFzZYpsWjLeen9krBeRxhZjHPKEOOYjm5SbepUXyT1PpWaVnDva3Jebxjf9afXDO8qDFhtBN3EYrgQtAcDXEND1/o8PCqUywqPT38o/6bJc6VzE+pS6AeO/GxBwzCpNw2qMlFRDBrFhX358H+uV96FX27wyurVMZRXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"type-unsafe한 api 호출\"\n        title=\"\"\n        src=\"/static/edee780ad281cfaa43ccbc7d226f05e7/f058b/type-unsafe.png\"\n        srcset=\"/static/edee780ad281cfaa43ccbc7d226f05e7/c26ae/type-unsafe.png 158w,\n/static/edee780ad281cfaa43ccbc7d226f05e7/6bdcf/type-unsafe.png 315w,\n/static/edee780ad281cfaa43ccbc7d226f05e7/f058b/type-unsafe.png 630w,\n/static/edee780ad281cfaa43ccbc7d226f05e7/58213/type-unsafe.png 902w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"타입 세이프하게 api를 호출해보기","date":"2024-05-04","description":"오버 엔지니어링인 감이 없지 않아 있다."}},"previous":{"fields":{"slug":"/type challange <Easy>/"},"frontmatter":{"title":"type challange <Easy>"}},"next":{"fields":{"slug":"/zustands는 어떻게 root provider 없이 상태관리를 할 수 있을까(1)/"},"frontmatter":{"title":"zustands는 어떻게 root provider 없이 상태관리를 할 수 있을까(1)"}}},"pageContext":{"id":"f60ee1fa-8ff9-5794-b402-e21d567fc740","previousPostId":"63ef87be-f787-5e4b-b690-a99e9ad1c3d1","nextPostId":"fcc608fb-7c94-5a4a-bed1-edf260ca39fa"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}